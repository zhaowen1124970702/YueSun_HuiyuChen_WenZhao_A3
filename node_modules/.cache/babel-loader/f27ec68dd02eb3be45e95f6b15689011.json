{"ast":null,"code":"var _jsxFileName = \"/Users/wenzhao/Desktop/p3/cs5610-project3/src/Component/Post.js\";\nimport React from 'react';\nimport Comment from './Comment';\nimport Axios from 'axios';\nimport Navbar from './Navbar';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class Post extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      idForQuery: props.query,\n      loginUser: null,\n      currentPost: {\n        \"title\": \" \",\n        \"username\": \" \",\n        \"URL\": \" \",\n        \"content\": \" \"\n      },\n      allComments: [],\n      newComment: \"\",\n      editing: false,\n      message: \"\",\n      title: \"\",\n      URL: \"\",\n      content: \"\"\n    };\n  }\n\n  getParams(location) {\n    const searchParams = new URLSearchParams(location.search);\n    return {\n      query: searchParams.get(\"query\") || \"\"\n    };\n  }\n\n  componentDidMount() {\n    Axios.get('/api/login/cookie').then(response => {\n      this.setState({\n        loginUser: response.data\n      });\n    }).catch(error => {\n      this.setState({\n        loginUser: null\n      });\n    });\n    Axios.get('/api/post/' + this.state.idForQuery).then(response => {\n      this.setState({\n        currentPost: response.data,\n        title: response.data.title,\n        username: response.data.username,\n        URL: response.data.URL,\n        content: response.data.content\n      });\n    }).catch(error => console.error(error));\n    Axios.get('/api/comment/' + this.state.idForQuery).then(response => {\n      this.setState({\n        allComments: response.data\n      });\n    }).catch(error => {\n      console.error(error);\n      this.setState({\n        allComments: []\n      });\n    });\n  }\n\n  componentDidUpdate() {}\n\n  submitDelete() {\n    Axios.delete('/api/post/' + this.state.currentPost._id).catch(error => {\n      this.setState({\n        message: \"Fail to delete post\"\n      });\n    });\n    Axios.delete('/api/comment/' + this.state.currentPost._id).then(response => {\n      window.location.href = \"/\";\n    }).catch(error => {\n      this.setState({\n        message: \"Fail to delete all comments\"\n      });\n    });\n  }\n\n  showEditandDelete() {\n    if (this.state.loginUser === this.state.currentPost.username) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: () => this.changeToEditingMode(),\n          children: \"Edit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: () => this.submitDelete(),\n          children: \"Delete\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }, this);\n    }\n  }\n\n  showPost() {\n    if (!this.state.editing) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Title: \", this.state.currentPost.title]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Editor: \", this.state.currentPost.username]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: this.state.currentPost.postTime\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"URL: \", this.state.currentPost.URL]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"OR\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Content: \", this.state.currentPost.content]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: this.showEditandDelete()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Title:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: this.state.title,\n          onChange: e => this.setState({\n            title: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"Editor:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 21\n        }, this), this.state.currentPost.username, this.state.currentPost.postTime, /*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"URL:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: this.state.URL,\n          onChange: e => this.setState({\n            URL: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"OR\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Content:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: this.state.content,\n          onChange: e => this.setState({\n            content: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: () => this.submitEdit(),\n          children: \"Submit Edit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 17\n      }, this);\n    }\n  }\n\n  submitEdit() {\n    const newPost = {};\n    newPost._id = this.state.currentPost._id;\n    newPost.title = this.state.title;\n    newPost.URL = this.state.URL;\n    newPost.content = this.state.content;\n\n    if (!newPost.content && !newPost.URL || newPost.content && newPost.URL) {\n      this.setState({\n        message: \"Only need URL or Content\"\n      });\n      return;\n    }\n\n    if (!newPost.title) {\n      return this.setState({\n        message: \"Please input title for the new post\"\n      });\n    }\n\n    Axios.put('/api/post', newPost).then(response => {\n      const postID = response.data._id;\n      window.location.href = \"post?id=\" + postID;\n    }).catch(error => {\n      this.setState({\n        message: \"Fail to update Post\"\n      });\n    });\n  }\n\n  changeToEditingMode() {\n    this.setState({\n      editing: true\n    });\n  }\n\n  submitAddNewComment() {\n    const newComment = {\n      editorUsername: this.state.loginUser,\n      postID: this.state.idForQuery,\n      content: this.state.newComment\n    };\n\n    if (this.state.newComment) {\n      Axios.post('/api/comment', newComment).then(response => {\n        window.location.href = \"post?id=\" + this.state.idForQuery;\n      }).catch(error => {\n        this.setState({\n          message: \"Fail to add new comment\"\n        });\n      });\n    }\n  }\n\n  showAddSubmit() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: this.state.newComment,\n        onChange: e => this.setState({\n          newComment: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: () => this.submitAddNewComment(),\n        children: \"Add Submit\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 13\n    }, this);\n  }\n\n  displayErrorMessage() {\n    if (this.state.message) {\n      return this.state.message;\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: () => this.redirectToHomePage(),\n        children: \"Home\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 17\n      }, this), this.showPost(), this.displayErrorMessage(), /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: [this.state.allComments.length, \" comments\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 17\n      }, this), this.showAddSubmit(), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: this.state.allComments.map((singleComment, index) => /*#__PURE__*/_jsxDEV(Comment, {\n          comment: singleComment,\n          loginUser: this.state.loginUser\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 74\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/wenzhao/Desktop/p3/cs5610-project3/src/Component/Post.js"],"names":["React","Comment","Axios","Navbar","Post","Component","constructor","props","state","idForQuery","query","loginUser","currentPost","allComments","newComment","editing","message","title","URL","content","getParams","location","searchParams","URLSearchParams","search","get","componentDidMount","then","response","setState","data","catch","error","username","console","componentDidUpdate","submitDelete","delete","_id","window","href","showEditandDelete","changeToEditingMode","showPost","postTime","e","target","value","submitEdit","newPost","put","postID","submitAddNewComment","editorUsername","post","showAddSubmit","displayErrorMessage","render","redirectToHomePage","length","map","singleComment","index"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Comment from './Comment';\nimport Axios from 'axios';\nimport Navbar from './Navbar';\n\n\nexport default class Post extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            idForQuery : props.query,\n            loginUser: null,\n            currentPost : {\"title\":\" \", \"username\":\" \", \"URL\":\" \", \"content\": \" \"},\n            allComments : [],\n            newComment : \"\",\n            editing: false,\n            message:\"\",\n            title:\"\",\n            URL:\"\",\n            content:\"\"\n        }\n    }\n\n    getParams(location) {\n        const searchParams = new URLSearchParams(location.search);\n        return {\n          query: searchParams.get(\"query\") || \"\"\n        };\n      }\n\n\n    componentDidMount() {\n        Axios.get('/api/login/cookie')\n            .then((response) => {\n                this.setState({\n                    loginUser: response.data\n                })\n            })\n            .catch((error) => {\n                this.setState({\n                    loginUser: null\n                })\n        })\n\n        Axios.get('/api/post/' + this.state.idForQuery)\n            .then((response) => {\n                this.setState({\n                    currentPost: response.data,\n                    title: response.data.title,\n                    username: response.data.username,\n                    URL: response.data.URL,\n                    content: response.data.content\n            })})\n            .catch(error => console.error(error));\n\n        Axios.get('/api/comment/' + this.state.idForQuery)\n        .then(\n            (response) => {\n                this.setState({\n                    allComments: response.data\n                })})\n        .catch(error => {\n            console.error(error);\n            this.setState({\n                allComments: []\n            })    \n        });\n\n    }\n\n    componentDidUpdate() {\n    }\n\n    \n    submitDelete(){\n        Axios.delete('/api/post/' + this.state.currentPost._id)\n            .catch((error) => {\n                this.setState( {\n                    message: \"Fail to delete post\"\n                })\n            })\n        \n        Axios.delete('/api/comment/' + this.state.currentPost._id)\n            .then((response) => {\n                window.location.href =\"/\";\n            })\n            .catch((error) => {\n                this.setState( {\n                    message: \"Fail to delete all comments\"\n                })\n            })\n        \n    }\n\n    showEditandDelete(){\n        if(this.state.loginUser === this.state.currentPost.username){\n            return(\n                <div>\n                    <div onClick={() => this.changeToEditingMode()}>\n                        Edit\n                    </div>\n                    <div onClick={() => this.submitDelete()}>\n                        Delete\n                    </div>\n                </div>\n            \n            )\n        }\n    }\n\n    showPost(){\n        if(!this.state.editing){\n            return(\n                <div>\n                    <div>Title: {this.state.currentPost.title}</div>\n                    <div>Editor: {this.state.currentPost.username}</div>\n                    <div>{this.state.currentPost.postTime}</div>\n                    <div>URL: {this.state.currentPost.URL}</div>\n                    <div>OR</div>\n                    <div>Content: {this.state.currentPost.content}</div>\n                    <div >{this.showEditandDelete()}</div>\n                </div>\n            )\n        }else{\n            return(\n                <div>\n                    <label >Title:</label>\n                    <input type=\"text\" value={this.state.title} onChange={e => this.setState({title: e.target.value})}></input>\n                    <div>Editor:</div>{this.state.currentPost.username}\n                    {this.state.currentPost.postTime}\n                    <label >URL:</label>\n                    <input type=\"text\" value={this.state.URL} onChange={e => this.setState({URL: e.target.value})}></input>\n                    <div>OR</div>\n                    <label >Content:</label>\n                    <input type=\"text\" value={this.state.content} onChange={e => this.setState({content: e.target.value})}></input>\n                    <div onClick={() => this.submitEdit()}>Submit Edit</div>\n                </div>\n            )\n        }\n    }\n\n    submitEdit(){\n        const newPost ={}\n        newPost._id = this.state.currentPost._id;\n        newPost.title = this.state.title;\n        newPost.URL = this.state.URL;\n        newPost.content = this.state.content;\n\n        if((!newPost.content && !newPost.URL) || (newPost.content && newPost.URL)){\n            this.setState({\n                message: \"Only need URL or Content\"\n            })\n            return\n        }\n\n        if(!newPost.title){\n            return this.setState({\n                message: \"Please input title for the new post\"\n            })\n        }\n\n        Axios.put('/api/post', newPost)\n        .then((response) => {\n            const postID = response.data._id;\n            window.location.href = \"post?id=\" + postID;\n        })\n        .catch((error) => {\n            this.setState( {\n                message: \"Fail to update Post\"\n            })\n        })\n\n\n    }\n\n    changeToEditingMode(){\n        this.setState( {\n            editing:true\n        })\n\n    }\n\n\n    submitAddNewComment(){\n        const newComment = {\n            editorUsername:this.state.loginUser,\n            postID:this.state.idForQuery,\n            content : this.state.newComment\n        }\n        if(this.state.newComment){\n            Axios.post('/api/comment', newComment)\n            .then((response) => {\n                window.location.href = \"post?id=\" + this.state.idForQuery;\n            })\n            .catch((error) => {\n                this.setState( {\n                    message: \"Fail to add new comment\"\n                })\n            })\n        }\n\n\n    }\n\n    showAddSubmit(){\n        return(\n            <div>\n                <input type=\"text\" value={this.state.newComment} onChange={e => this.setState({newComment: e.target.value})}></input>\n                <div onClick={() => this.submitAddNewComment()}>Add Submit</div>\n            </div>\n\n        )\n    }\n\n    displayErrorMessage(){\n        if(this.state.message){\n            return this.state.message\n        }  \n    }\n\n\n    render() {\n\n        return (\n            <div>\n                <Navbar></Navbar>\n                <div onClick={() => this.redirectToHomePage()}>Home</div>\n                {this.showPost()}\n                {this.displayErrorMessage()}\n                <h2>{this.state.allComments.length} comments</h2>\n                {this.showAddSubmit()}\n                <div>{this.state.allComments.map((singleComment, index)=><Comment key ={index} comment ={singleComment} loginUser = {this.state.loginUser}></Comment>)}</div>\n\n            </div>\n\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}